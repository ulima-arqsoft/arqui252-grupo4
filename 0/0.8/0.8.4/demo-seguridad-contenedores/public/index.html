<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Demo Seguridad de Contenedores</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1> Sistema de Compras Seguras</h1>
    </header>

    <main>
        <h2>Productos Disponibles</h2>
        <ul id="product-list">
            <p>Cargando productos...</p>
        </ul>
        
        <p><strong>Nota de la Demo:</strong> Revise el código para ver cómo se cargan los secretos y cómo se construye el contenedor.</p>
        <button onclick="testAttack()">Probar Ataque Saliente (EGRESS)</button>
        <p id="attack-status"></p>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', fetchProducts);

        async function fetchProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                const list = document.getElementById('product-list');
                list.innerHTML = ''; // Limpiar
                
                products.forEach(p => {
                    const item = document.createElement('li');
                    item.textContent = `${p.name} - $${p.price.toFixed(2)}`;
                    list.appendChild(item);
                });
            } catch (error) {
                console.error("Error al cargar productos:", error);
                document.getElementById('product-list').innerHTML = '<p style="color: red;">Error al conectar con la API del backend.</p>';
            }
        }

        async function testAttack() {
            const statusElement = document.getElementById('attack-status');
            statusElement.textContent = 'Iniciando prueba de conexión externa...';

            try {
                const response = await fetch('/api/attack-test');
                const result = await response.text();
                statusElement.textContent = `Resultado del Test: ${result}`;
                if (response.status === 500) {
                     statusElement.style.color = 'green';
                } else {
                     statusElement.style.color = 'red';
                }
            } catch (error) {
                statusElement.textContent = `Error de red al intentar la prueba. Esto puede indicar que la Network Policy está bloqueando la solicitud.`;
                statusElement.style.color = 'green';
            }
        }
    </script>
</body>
</html>