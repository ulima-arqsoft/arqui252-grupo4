# 0.6.3 Leonardo Miguel Pachas Cleonares
## Excluyendo MongoDB. Ejemplo: Cosmos DB
### Proyecto: GameVault – Catálogo de Productos

---

## 1. Introducción
En las arquitecturas modernas de software, las bases de datos NoSQL se han convertido en componentes esenciales para manejar grandes volúmenes de información de manera flexible, escalable y distribuida.  
Dentro de este ecosistema, **Azure Cosmos DB** surge como una alternativa avanzada a **MongoDB**, ofreciendo un modelo **multimodal**, baja latencia y replicación global automatizada dentro del entorno **Azure Cloud**.  

En el proyecto **GameVault**, una plataforma e-commerce enfocada en la compra y venta de videojuegos y juegos de mesa, Cosmos DB cumple un rol clave al permitir el almacenamiento eficiente de catálogos, usuarios y transacciones sin depender de un motor relacional tradicional.

---

## 2. Desarrollo Conceptual
Una **base de datos NoSQL multimodelo distribuida** permite gestionar datos no estructurados y semiestructurados a gran escala. A diferencia de los modelos relacionales, prioriza la **escalabilidad horizontal** y la **baja latencia** mediante particionamiento y replicación.

**Cosmos DB** es un ejemplo de este enfoque: una base de datos **NoSQL globalmente distribuida y multimodelo** de Microsoft.  
Entre sus principales características destacan:

- **Modelos soportados:**
  - SQL (JSON documents)
  - Cassandra (columnar)
  - Gremlin (graphs)
  - Table (key-value)
  - PostgreSQL (relacional distribuido)

- **Replicación automática** en múltiples regiones.  
- **Cinco niveles de consistencia:** *Strong*, *Bounded Staleness*, *Session*, *Consistent Prefix* y *Eventual*.  
- **Garantías de SLA:** disponibilidad del 99.999% y latencias menores a 10 ms.  

En una arquitectura **basada en microservicios**, Cosmos DB permite que cada servicio mantenga independencia de datos y escale de forma autónoma, evitando los cuellos de botella comunes de las bases relacionales.

---

## 3. Ventajas y Desventajas

| **Ventajas** | **Desventajas** |
|---------------|----------------|
| Escalabilidad global y automática | Costos más altos que soluciones locales |
| Soporte multimodelo (documental, grafos, tablas, etc.) | Requiere experiencia para optimizar RU/s |
| Baja latencia y disponibilidad garantizada | Solo disponible en el ecosistema Azure |
| Replicación y consistencia configurables | Dependencia de conexión a Internet |
| Integración nativa con Power BI y Azure Functions | Curva de aprendizaje inicial más alta |

---

## 4. Aplicación en el Proyecto GameVault
**GameVault** necesita manejar grandes volúmenes de productos, usuarios y pedidos en tiempo real.  
Cosmos DB se integra en el **módulo de Catálogo de Productos**, asegurando rendimiento y consistencia en operaciones de lectura y escritura.

| **Módulo** | **Uso de Cosmos DB** |
|-------------|---------------------|
| Catálogo de Productos | Cada videojuego se almacena como documento JSON con nombre, consola, precio, rareza, etc. |
| Gestión de Usuarios | Guarda roles, historial de compras y reseñas. |
| Carrito y Pedidos | Registra órdenes en tiempo real con consistencia de sesión. |
| Pagos | Maneja tokens y resultados de transacciones con consistencia fuerte. |
| Reseñas y Comunidad | Asocia comentarios y valoraciones con usuarios y productos. |
| Reportes | Conexión directa a Power BI mediante Synapse Link. |

**Flujo básico de operación:**
1. El usuario selecciona un videojuego.  
2. El backend (FastAPI) registra la orden en Cosmos DB.  
3. Cosmos DB replica la información en múltiples regiones.  
4. Los administradores visualizan estadísticas en Power BI en tiempo real.

---

## 5. Consideraciones Técnicas

### **Requisitos Previos**
- Cuenta activa en **Azure Portal**.  
- Python 3.10+, **FastAPI** y SDK de **Azure Cosmos**.  
- Entorno local (VS Code, Docker, etc.).  

### **Creación del Recurso**
1. En Azure Portal → *Create Resource → Azure Cosmos DB for NoSQL (Core API)*.  
2. Configurar:  
   - **Account Name:** gamevault-db  
   - **Region:** East US (o más cercana)  
   - **Throughput:** Autoscale (400–4000 RU/s)  
3. Crear la base de datos **GameVault** y el contenedor **Products**, con partición `/category`.

---

## 6. Demo – Código de Ejemplo (FastAPI + CosmosDB)

```python
from fastapi import FastAPI
from azure.cosmos import CosmosClient
import os

app = FastAPI()

URL = os.getenv("COSMOSDB_URL", "https://<TU_CUENTA>.documents.azure.com:443/")
KEY = os.getenv("COSMOSDB_KEY", "<TU_LLAVE_PRIMARIA>")
DB_NAME = "GameVault"
CONTAINER_NAME = "Products"

client = CosmosClient(URL, credential=KEY)
database = client.get_database_client(DB_NAME)
container = database.get_container_client(CONTAINER_NAME)

@app.post("/add_product")
async def add_product(item: dict):
    container.create_item(body=item)
    return {"message": "Producto agregado exitosamente"}

@app.get("/products")
async def list_products():
    query = "SELECT * FROM c WHERE c.category = 'Retro'"
    items = list(container.query_items(query=query, enable_cross_partition_query=True))
    return {"products": items}
