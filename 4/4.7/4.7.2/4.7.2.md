> [4. Decisiones Iniciales de Arquitectura](../../4.md) ‚Ä∫ [4.7. Listado Consolidado](../4.7.md) ‚Ä∫ [4.7.2. Modelo de Coordinaci√≥n](4.7.2.md)

# 4.7.2. Modelo de Coordinaci√≥n

Este apartado define los mecanismos a trav√©s de los cuales los microservicios de GameVault interact√∫an entre s√≠, garantizando la consistencia y el desacoplamiento.

## 00: Decisiones Generales
---
### Decisi√≥n 1: Patr√≥n de Comunicaci√≥n Inter-Servicios Principal

**T√≠tulo:**
Elecci√≥n del Patr√≥n de Comunicaci√≥n Principal: S√≠ncrono vs. As√≠ncrono

**Contexto:**
GameVault requiere baja latencia para la interacci√≥n con el usuario (ej. b√∫squeda de productos, perfil de usuario) y una coordinaci√≥n altamente confiable y auditable para los flujos transaccionales (ej. creaci√≥n de pedidos, registro de pagos).

**Alternativas:**

* **S√≠ncrono Exclusivo (REST/gRPC):** F√°cil de implementar, pero genera alto acoplamiento y riesgos de fallos en cascada entre servicios.
* **As√≠ncrono Exclusivo (Event-Driven):** M√°ximo desacoplamiento, pero dificulta la retroalimentaci√≥n inmediata al usuario sobre acciones completadas.
* **H√≠brido (REST + Event-Driven):** Utiliza lo mejor de ambos: S√≠ncrono para lecturas y As√≠ncrono para procesos de fondo o interacciones complejas.

**Criterios de Elecci√≥n:**

* **Desacoplamiento:** Reducir la dependencia entre m√≥dulos transaccionales.
* **Latencia de Lectura:** Asegurar una respuesta r√°pida para el frontend.
* **Trazabilidad:** Capacidad de monitorear y auditar flujos de larga duraci√≥n.

**Decisi√≥n:**
Se adopta un Modelo de Comunicaci√≥n **H√≠brido**: RESTful API para interacciones s√≠ncronas de lectura/escritura simples y Mensajer√≠a As√≠ncrona (Eventos/Colas) para la coordinaci√≥n de procesos transaccionales y la replicaci√≥n de datos.

**Sustento:**
El modelo H√≠brido optimiza la **Latencia de Lectura** mediante llamadas REST directas. La comunicaci√≥n **As√≠ncrona** a√≠sla los m√≥dulos transaccionales de fallos en servicios secundarios, mejorando el **Desacoplamiento** y la resiliencia general del sistema.

### Decisi√≥n 2: Coordinaci√≥n de Acceso del Frontend
---
**T√≠tulo:**
Estrategia de Orquestaci√≥n para el Acceso Externo (Frontend)

**Contexto:**
El frontend (Web/M√≥vil) debe consumir datos de m√∫ltiples m√≥dulos (ej. una p√°gina de producto necesita datos del CP, GU y CR) y autenticarse una sola vez. Se necesita un √∫nico punto de entrada para manejar la l√≥gica de enrutamiento y agregaci√≥n.

**Alternativas:**

* **Llamadas Directas del Cliente:** El frontend conoce y llama a cada microservicio individualmente. Introduce complejidad en el cliente y acoplamiento con la topolog√≠a de la red interna.
* **API Gateway Centralizado:** Un punto de entrada que maneja seguridad, limitaci√≥n de tasa y enrutamiento a los microservicios.
* **Backend for Frontend (BFF):** Una variaci√≥n del Gateway, donde el Gateway tiene l√≥gica de negocio espec√≠fica para componer las vistas del cliente.

**Criterios de Elecci√≥n:**

* **Seguridad:** Centralizar la autenticaci√≥n y autorizaci√≥n.
* **Composici√≥n:** Capacidad de agregar datos de m√∫ltiples m√≥dulos en una sola respuesta.
* **Simplicidad para el Cliente:** Exponer una interfaz limpia y √∫nica al frontend.

**Decisi√≥n:**
Implementaci√≥n de un **API Gateway Centralizado** que act√∫e como punto de entrada √∫nico, gestionando la seguridad y el enrutamiento. Se utiliza REST (JSON/HTTP) como protocolo est√°ndar.

**Sustento:**
El API Gateway centraliza la **Seguridad** y simplifica el cliente. Utilizar REST para la comunicaci√≥n externa es el est√°ndar de la industria, garantizando **Simplicidad para el Cliente** y facilidad de integraci√≥n con cualquier plataforma (Web, iOS, Android).

## 01: M√≥dulo: Cat√°logo de Productos
--
### Decisi√≥n 1: Mecanismo de Consulta de Productos

**T√≠tulo:**
Protocolo para Consultas de Productos (Lectura) desde el Frontend

**Contexto:**
El Cat√°logo es el m√≥dulo con la mayor demanda de lectura (b√∫squeda y filtros). La consulta debe ser de baja latencia.

**Alternativas:**

* **API REST S√≠ncrona:** Consulta directa a la API, simple y r√°pida.
* **Eventos As√≠ncronos:** No es adecuado para consultas directas de lectura.

**Criterios de Elecci√≥n:**

* **Latencia:** Minimizar el tiempo de respuesta.
* **Simplicidad:** Facilidad de implementaci√≥n y consumo.

**Decisi√≥n:**
Comunicaci√≥n **S√≠ncrona** a trav√©s del API Gateway (RESTful API) para todas las consultas de productos.

**Sustento:**
La consulta directa (**s√≠ncrona**) es el mecanismo m√°s eficiente para el acceso a datos de solo lectura, cumpliendo con la exigencia de **Baja Latencia** del Cat√°logo.

## 02: M√≥dulo: Gesti√≥n de Usuarios
---
### Decisi√≥n 1: Consulta S√≠ncrona de Perfiles de Usuario

**T√≠tulo:**
Mecanismo para Consultar Roles y Perfiles de Usuario

**Contexto:**
M√≥dulos como CCP, SP y CR necesitan consultar la informaci√≥n b√°sica del usuario (ID, nombre, rol de comprador/vendedor) en tiempo real para autorizar o contextualizar una transacci√≥n/rese√±a.

**Alternativas:**

* **Llamada S√≠ncrona a la API de GU (REST):** Consulta directa y de baja latencia al microservicio GU.
* **Replicaci√≥n de Datos (Anti-Pattern):** Otros m√≥dulos replican los datos del perfil de usuario en sus propias bases de datos.

**Criterios de Elecci√≥n:**

* **Oportunidad:** Necesidad de informaci√≥n de usuario en tiempo real (ej. rol de vendedor/comprador).
* **Consistencia:** El perfil del usuario debe ser siempre la √∫nica fuente de verdad.

**Decisi√≥n:**
Comunicaci√≥n **S√≠ncrona** a trav√©s de RESTful API para consultas de perfil.

**Sustento:**
La llamada **S√≠ncrona** a GU garantiza la **Consistencia** y la **Oportunidad** de la informaci√≥n del perfil y rol, ya que los datos se consultan de la fuente de verdad en el momento de la necesidad.

## 03: M√≥dulo: Carrito de Compras y Pedidos
---
### Decisi√≥n 1: Flujo de Creaci√≥n de Pedido y Pago (SAGA Orquestada)

**T√≠tulo:**
Mecanismo de Coordinaci√≥n para la Transacci√≥n de Venta

**Contexto:**
La creaci√≥n de un pedido es un flujo de tres pasos cr√≠ticos: CCP (Pedido/Inventario) $\rightarrow$ SP (Pago) $\rightarrow$ LE (Log√≠stica). Requiere alta Consistencia global y capacidad de reversi√≥n (compensaci√≥n).

**Alternativas:**

* **Llamada S√≠ncrona Encadenada (REST):** Alto acoplamiento, fallos en cascada.
* **Patr√≥n SAGA (Orquestado):** El M√≥dulo CCP coordina y dirige los pasos del flujo con mensajes as√≠ncronos, gestionando la reversi√≥n en caso de fallo.

**Criterios de Elecci√≥n:**

* **Integridad Transaccional Distribuida:** Asegurar que los pasos se completen o se reviertan.
* **Desacoplamiento:** Reducir la dependencia de tiempo de ejecuci√≥n entre CCP, SP y LE.

**Decisi√≥n:**
Uso del patr√≥n **SAGA Orquestado** (implementado v√≠a mensajer√≠a as√≠ncrona) donde el M√≥dulo CCP act√∫a como el orquestador principal del flujo.

**Sustento:**
La **SAGA** permite lograr la **Integridad Transaccional Distribuida** sin acoplamiento, usando Mensajer√≠a As√≠ncrona. Esto es crucial para la robustez del proceso de venta.

## 04: M√≥dulo: Sistema de Pagos
---
### Decisi√≥n 1: Comunicaci√≥n con Pasarelas Externas

**T√≠tulo:**
Protocolo de Interacci√≥n con Servicios de Pago Externos (PayPal, Yape, Plin)

**Contexto:**
El M√≥dulo SP debe comunicarse con sistemas de terceros de alta seguridad y latencia variable (pasarelas de pago). La confirmaci√≥n del pago debe ser confiable y no depender de que el usuario permanezca en la p√°gina.

**Alternativas:**

* **Polling S√≠ncrono:** SP consulta repetidamente a la pasarela hasta que el pago se confirma. (Ineficiente y consume recursos).
* **Webhooks As√≠ncronos (Callback):** SP inicia el pago y espera una notificaci√≥n (WebHook) de la pasarela para la confirmaci√≥n final.

**Criterios de Elecci√≥n:**

* **Fiabilidad:** Garantizar que la notificaci√≥n de pago no se pierda.
* **Est√°ndar de Seguridad:** Utilizar el mecanismo de notificaci√≥n est√°ndar de los proveedores de pago.

**Decisi√≥n:**
Uso de **Webhooks As√≠ncronos (Callbacks)** para la confirmaci√≥n de pago y API REST/SDK S√≠ncrono para el inicio del proceso.

**Sustento:**
Los **Webhooks** son el est√°ndar de la industria para pagos, lo que garantiza la **Fiabilidad** de la notificaci√≥n de pago (incluso si la conexi√≥n del usuario se pierde) y mantiene a SP *decoupled* del proceso de espera.

## 05: M√≥dulo: Comunidad y Rese√±as
---
### Decisi√≥n 1: Propagaci√≥n de Eventos de Rese√±as y Comentarios

**T√≠tulo:**
Mecanismo para Sincronizar el Promedio de Valoraci√≥n de Rese√±as en el Cat√°logo

**Contexto:**
Cuando se aprueba una rese√±a en el M√≥dulo CR, el M√≥dulo CP necesita actualizar su metadato de "Puntuaci√≥n Promedio" para mostrarlo en las p√°ginas de producto y listados.

**Alternativas:**

* **Llamada S√≠ncrona (CR a CP):** Bloquea el flujo de CR y si CP falla, el proceso de rese√±a se detiene.
* **Modelo Push (CR Publica Evento):** CR emite un evento y CP consume este evento para realizar la actualizaci√≥n de forma as√≠ncrona.

**Criterios de Elecci√≥n:**

* **Desacoplamiento:** El c√°lculo y la persistencia de la rese√±a (CR) deben ser independientes de la actualizaci√≥n del metadato (CP).
* **Resiliencia:** Si CP est√° ca√≠do, CR debe poder seguir aceptando rese√±as.
z
**Decisi√≥n:**
Comunicaci√≥n **As√≠ncrona (Eventos)**. CR publica eventos de dominio al que CP se suscribe.

**Sustento:**
El modelo **As√≠ncrono** garantiza el **Desacoplamiento** y la **Resiliencia**. El M√≥dulo CR completa su trabajo y el M√≥dulo CP realiza una actualizaci√≥n pasiva de los metadatos.

## 06: M√≥dulo: An√°lisis de Datos y Reportes
---
### Decisi√≥n 1: Integraci√≥n de Datos para Reportes

**T√≠tulo:**
Integraci√≥n de Datos para el M√≥dulo de An√°lisis y Reportes

**Contexto:**
El M√≥dulo ADR necesita consumir datos de todos los microservicios (CP, CCP, GU, CR, SP, LE) para construir su Data Warehouse y Data Lake. La ingesta de datos debe ser pasiva, continua y de alto rendimiento.

**Alternativas:**

* **Consultas a Bases de Datos (Anti-Pattern):** Acceso directo de ADR a las bases de datos de producci√≥n.
* **Event Streaming (Kafka):** Todos los microservicios publican eventos de negocio que ADR consume y procesa as√≠ncronamente.

**Criterios de Elecci√≥n:**

* **Aislamiento:** ADR debe estar totalmente desacoplado de los sistemas operativos (OLTP).
* **Tiempos de Proceso:** Los reportes pueden tolerar un ligero retardo (*near real-time*) para priorizar el rendimiento del *core*.

**Decisi√≥n:**
Uso de **Event Streaming (As√≠ncrono)**. Todos los microservicios publican eventos clave de negocio que ADR consume.

**Sustento:**
El **Event Streaming** garantiza el **Aislamiento** del M√≥dulo ADR de los dem√°s microservicios. Permite la ingesta de datos de manera eficiente y as√≠ncrona, sin impactar el rendimiento de los m√≥dulos cr√≠ticos transaccionales.

---

[‚¨ÖÔ∏è Anterior](../4.7.1/4.7.1.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../4.7.3/4.7.3.md)