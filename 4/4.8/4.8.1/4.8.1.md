> [4. Decisiones Iniciales de Arquitectura](../../4.md) ‚Ä∫ [4.8. Listado Consolidado](../4.8.md) ‚Ä∫ [4.8.1. Asignaci√≥n de Responsabilidades](4.8.1.md)

# 4.8.1. Asignaci√≥n de Responsabilidades

Este apartado define las fronteras de cada microservicio (m√≥dulo) y las responsabilidades √∫nicas que asume dentro del sistema.

## 00: Decisiones Generales
---
### Decisi√≥n 1: Elecci√≥n entre arquitectura monol√≠tica y de microservicios

**T√≠tulo:**
Elecci√≥n entre Arquitectura Monol√≠tica y Arquitectura de Microservicios

**Contexto:**
GameVault requiere manejar m√∫ltiples dominios (compra/venta, cat√°logo masivo, log√≠stica) con diferentes ritmos de cambio y demandas de escalabilidad. El Cat√°logo es de solo lectura y el Carrito/Pedidos es transaccional cr√≠tico, exigiendo alta disponibilidad.

**Alternativas:**

* **Arquitectura Monol√≠tica:** Todos los m√≥dulos integrados. Simplifica el desarrollo inicial, pero un fallo en cualquier componente puede afectar toda la plataforma. Dificulta la escalabilidad modular.

* **Arquitectura de Microservicios:** Cada dominio funciona como servicio independiente. Permite escalabilidad granular, aislamiento de fallos y el uso de tecnolog√≠as espec√≠ficas por m√≥dulo.

**Criterios de Elecci√≥n:**

* **Escalabilidad:** Capacidad de escalar m√≥dulos de alta demanda (Cat√°logo) independientemente de los transaccionales (Pedidos).

* **Disponibilidad y Tolerancia a Fallos:** Garantizar que un fallo en un m√≥dulo no detenga las ventas o la b√∫squeda.

* **Flexibilidad Tecnol√≥gica:** Posibilidad de usar diferentes bases de datos o lenguajes seg√∫n la necesidad del m√≥dulo.

**Decisi√≥n:**
  Arquitectura de Microservicios.

**Sustento:**
  La diferencia en los requisitos de datos y la carga de trabajo entre los dominios de GameVault (ej. Cat√°logo masivo vs. Carrito transaccional) justifica la separaci√≥n. Esta arquitectura garantiza el **Desacoplamiento** y permite la **Escalabilidad Horizontal** granular, lo cual es vital para una plataforma de comercio electr√≥nico que prioriza la **Disponibilidad** de las ventas.

### Decisi√≥n 2: Asignaci√≥n de responsabilidades entre m√≥dulos frontend y backend

**T√≠tulo:**
Divisi√≥n de Responsabilidades entre Frontend (UI) y Backend (L√≥gica de Negocio)

**Contexto:**
GameVault requiere alta interactividad (filtrado instant√°neo, experiencia de compra fluida) con m√°xima seguridad y consistencia en las transacciones (precios, impuestos). Es crucial definir d√≥nde reside la l√≥gica de negocio central.

**Alternativas:**

* **Frontend Grueso:** El Frontend maneja la mayor parte de las validaciones y l√≥gica de estado, usando el Backend solo para persistencia b√°sica.

* **Enfoque H√≠brido:** Frontend maneja estado de UI y validaciones de formato. Backend gestiona la l√≥gica de negocio cr√≠tica, la seguridad, y la consistencia de los datos.

**Criterios de Elecci√≥n:**

* **Seguridad:** La l√≥gica de precios y descuentos debe ser inalterable por el usuario.

* **Consistencia:** Asegurar que los datos mostrados reflejen siempre la √∫nica fuente de verdad.

* **Experiencia de Usuario (UX):** Permitir interacciones r√°pidas y fluidas.

**Decisi√≥n:**
  Enfoque H√≠brido: Backend como Fuente √önica de Verdad para el Negocio.

**Sustento:**
  El Backend es el √∫nico responsable de la **Seguridad** y la **Consistencia** (aplicaci√≥n de reglas de precios e impuestos), previniendo fraude. El Frontend (React) optimiza la **UX** gestionando el estado de la UI y las validaciones de formato.

## 01: M√≥dulo: Cat√°logo de Productos
---
### Decisi√≥n 1: Responsabilidad de la Ingesta y Dispersi√≥n de Datos para B√∫squeda y Filtrado.

**T√≠tulo:**
Estrategia de Persistencia para B√∫squeda y Filtrado de Cat√°logo

**Contexto:**
El Cat√°logo (CP) maneja millones de registros y debe permitir b√∫squedas y filtrados por m√∫ltiples criterios (consola, g√©nero, condici√≥n, rareza) con latencia ultrabaja.

**Alternativas:**

* **Base de Datos Relacional Tradicional:** Usar solo PostgreSQL o MySQL. F√°cil de gestionar, pero lento para b√∫squedas de texto completo y filtrados multidimensionales complejos.

* **Motor de B√∫squeda Dedicado:** Utilizar un motor especializado (ej. Elasticsearch, Solr) para indexar los datos relevantes. Ofrece velocidad y funcionalidad avanzada de b√∫squeda.

**Criterios de Elecci√≥n:**

* **Velocidad de Respuesta:** B√∫squedas y filtros casi instant√°neos ($\le 100$ ms).

* **Funcionalidad:** Soporte nativo para *faceted search* y b√∫squeda de texto.

* **Disponibilidad:** Garantizar que el servicio de b√∫squeda no falle.

**Decisi√≥n:**
  Utilizar un motor de b√∫squeda/√≠ndice dedicado (ej. Elasticsearch) para b√∫squedas y filtrado de alto rendimiento.

**Sustento:**
  Un motor de b√∫squeda dedicado garantiza la **Velocidad de Respuesta** y **Disponibilidad** requeridas para el Cat√°logo. El microservicio CP ser√° responsable de mantener la consistencia entre la base de datos maestra (para la verdad de los datos) y el √≠ndice de b√∫squeda (para la velocidad de consulta).

## 02: M√≥dulo: Gesti√≥n de Usuarios
---
### Decisi√≥n 1: Responsabilidad de la gesti√≥n de la identidad y autenticaci√≥n de usuarios.

**T√≠tulo:**
Delegaci√≥n de la Gesti√≥n de Autenticaci√≥n y Credenciales

**Contexto:**
El M√≥dulo GU debe manejar el registro, inicio de sesi√≥n (*passwordless*, redes sociales), perfiles y autorizaci√≥n para los roles Comprador y Vendedor. La seguridad y el cumplimiento de est√°ndares son prioritarios.

**Alternativas:**

* **Integrar Identidad en GU:** GU almacena credenciales, emite *tokens* y valida permisos, asumiendo toda la carga de seguridad.

* **Delegar a un Identity Provider (IdP) Externo:** Usar un servicio especializado (ej. Auth0, Firebase Auth) para manejar credenciales, delegando solo la gesti√≥n del perfil de usuario a GU.

**Criterios de Elecci√≥n:**

* **Seguridad y Cumplimiento:** Protecci√≥n de credenciales y uso de est√°ndares (OAuth 2.0, MFA).

* **Eficiencia de Desarrollo:** Reducir la complejidad de implementar autenticaci√≥n y recuperaci√≥n de contrase√±as.

* **Separaci√≥n de Responsabilidades:** Aislar la l√≥gica de seguridad del perfil.

**Decisi√≥n:**
  Delegar la gesti√≥n de credenciales y *tokens* a un IdP externo, con GU gestionando el perfil de usuario y los roles.

**Sustento:**
  Delegar la seguridad a un IdP externo maximiza la **Seguridad** y eficiencia, ya que subcontrata una funcionalidad compleja. GU se enfoca en ser el servicio de perfil enriquecido de GameVault (nombre de *gamer*, *avatar*, roles) sin gestionar credenciales sensibles.

## 03: M√≥dulo: Carrito de Compras y Pedidos
---
### Decisi√≥n 1: Responsabilidad de la L√≥gica de C√°lculo de Precios y Creaci√≥n At√≥mica de Pedidos.

**T√≠tulo:**
Centralizaci√≥n de la L√≥gica de *Checkout* y Consistencia Transaccional

**Contexto:**
CCP debe calcular el precio final (precio base + impuestos - descuentos) de manera precisa y crear el objeto "Pedido" de forma at√≥mica (reservando el inventario si aplica) antes de interactuar con el Sistema de Pagos.

**Alternativas:**

* **L√≥gica Distribuida:** El M√≥dulo GU calcula descuentos, el M√≥dulo CP da el precio base, y CCP solo orquesta. (Riesgo de inconsistencia y latencia).

* **L√≥gica Centralizada en CCP:** CCP consulta precios (CP) y descuentos (GU) y aplica toda la l√≥gica de c√°lculo y reserva internamente.

**Criterios de Elecci√≥n:**

* **Consistencia Transaccional:** El precio pagado debe ser el precio final del pedido.

* **Seguridad:** Prevenir manipulaci√≥n de c√°lculos.

* **Trazabilidad:** Facilidad para auditar la l√≥gica de precios.

**Decisi√≥n:**
  Centralizar la l√≥gica de c√°lculo y la creaci√≥n del objeto "Pedido" en CCP antes de la integraci√≥n con el Sistema de Pagos.

**Sustento:**
  Centralizar la l√≥gica en CCP permite controlar la **Consistencia Transaccional** y la **Seguridad** de forma at√≥mica. CCP se convierte en la √∫nica fuente de verdad del pedido en curso, generando un ID que referenciar√° el Pago y la Log√≠stica, simplificando la **trazabilidad**.

## 04: M√≥dulo: Sistema de Pagos
---
### Decisi√≥n 1: Responsabilidad del cumplimiento de seguridad de datos sensibles.

**T√≠tulo:**
Estrategia para el Manejo y Custodia de Datos Financieros Sensibles

**Contexto:**
SP debe integrarse con m√∫ltiples pasarelas (PayPal, Yape, Plin) y gestionar la confirmaci√≥n de la transacci√≥n. Es imperativo cumplir con los est√°ndares de seguridad financiera (PCI DSS) y minimizar la exposici√≥n a datos sensibles.

**Alternativas:**

* **SP Almacena Datos:** SP captura y almacena informaci√≥n de tarjetas de cr√©dito/billeteras. (Implica cumplimiento PCI DSS completo y auditor√≠as complejas).

* **Delegaci√≥n con Tokenizaci√≥n:** SP usa *widgets* o redirecciones de las pasarelas para que el cliente ingrese sus datos en la pasarela, y solo recibe un *token* de vuelta para procesar el pago.

**Criterios de Elecci√≥n:**

* **Seguridad:** M√°xima protecci√≥n de la informaci√≥n del cliente.

* **Cumplimiento:** Reducir el alcance del cumplimiento PCI DSS en la infraestructura de GameVault.

* **Complejidad Operacional:** Minimizar la gesti√≥n de infraestructura de alta seguridad.

**Decisi√≥n:**
  Delegar la custodia y manejo de informaci√≥n financiera sensible a las pasarelas de pago externas (Uso de *tokens* o redirecciones).

**Sustento:**
  Delegar esta responsabilidad reduce dr√°sticamente el riesgo de **seguridad** y el alcance del **cumplimiento PCI DSS** en GameVault, ya que el m√≥dulo SP solo manejar√° *tokens* de transacci√≥n y confirmaciones de pago, nunca los datos de tarjetas de cr√©dito.

## 05: M√≥dulo: Log√≠stica y Env√≠os
---
### Decisi√≥n 1: Responsabilidad del C√°lculo de Costos en Tiempo Real y el Seguimiento As√≠ncrono.

**T√≠tulo:**
Estrategia de Comunicaci√≥n para Costos de Env√≠o y Trazabilidad

**Contexto:**
LE debe interactuar con APIs de transportistas para dos tareas diferentes: 1) Calcular el costo de env√≠o (cr√≠tico, s√≠ncrono, durante el *checkout*) y 2) Actualizar el estado del seguimiento del pedido (no cr√≠tico, as√≠ncrono, post-compra).

**Alternativas:**

* **Completamente S√≠ncrono:** Todas las interacciones, incluido el seguimiento, se hacen v√≠a REST/API, bloqueando el proceso principal. (Riesgo de latencia en el seguimiento).

* **Integraci√≥n S√≠ncrona / Worker As√≠ncrono:** C√°lculo de costos s√≠ncrono. Seguimiento de estado delegado a un proceso secundario (*Worker Service*).

**Criterios de Elecci√≥n:**

* **Velocidad de Checkout:** El c√°lculo del costo no debe a√±adir latencia excesiva.

* **Aislamiento de Fallos:** Los fallos en la API de seguimiento de la transportista no deben afectar el *checkout*.

* **Eficiencia:** El seguimiento requiere consultas peri√≥dicas a APIs externas.

**Decisi√≥n:**
  Integraci√≥n S√≠ncrona para el C√°lculo de Costos y un Worker Service As√≠ncrono para el Seguimiento del Estado.

**Sustento:**
  El c√°lculo de costos es un requisito cr√≠tico y **s√≠ncrono** que debe ser r√°pido. El seguimiento es ideal para un *Worker Service* **As√≠ncrono** porque requiere tareas peri√≥dicas (consultas a la API del transportista) que podr√≠an ser lentas o fallar, aislando esta complejidad del flujo de venta principal.

## 06: M√≥dulo: Comunidad y Rese√±as
---
### Decisi√≥n 1: Separaci√≥n de la L√≥gica de Moderaci√≥n de Rese√±as de la Persistencia de Datos.

**T√≠tulo:**
Gesti√≥n de Moderaci√≥n de Contenido Generado por el Usuario

**Contexto:**
CR permite a los usuarios dejar rese√±as y valoraciones. El contenido debe pasar por moderaci√≥n (lenguaje inapropiado, *spam*, etc.) sin generar latencia para la experiencia de env√≠o del usuario.

**Alternativas:**

* **Moderaci√≥n S√≠ncrona:** El servicio CR aplica los filtros y persiste la rese√±a en estado final antes de responder al usuario. (Alta latencia, mal UX).

* **Moderaci√≥n As√≠ncrona:** El servicio CR persiste la rese√±a en estado "Pendiente" y un *Worker* (o funci√≥n *serverless*) aplica la moderaci√≥n en segundo plano.

**Criterios de Elecci√≥n:**

* **Rendimiento/UX:** Evitar latencia en la confirmaci√≥n de env√≠o de la rese√±a.

* **Robustez:** Aislar la l√≥gica pesada de procesamiento de texto/IA para el filtrado.

**Decisi√≥n:**
  Delegaci√≥n de la Moderaci√≥n a un Servicio As√≠ncrono.

**Sustento:**
  Confirmar la rese√±a al usuario inmediatamente (estado "Pendiente") mejora la **UX** y el **Rendimiento**. Aislar la l√≥gica de moderaci√≥n en un proceso as√≠ncrono garantiza la **Robustez** del microservicio principal y permite procesar contenido con herramientas especializadas (ej. ML para detecci√≥n de *spam*) sin bloquear la API web.

## 07: M√≥dulo: An√°lisis de Datos y Reportes

### Decisi√≥n 1: Fuente de Datos para la Generaci√≥n de Reportes y M√©tricas.

**T√≠tulo:**
Estrategia de Persistencia para Consultas Anal√≠ticas

**Contexto:**
ADR debe generar m√©tricas complejas (*ranking* de ventas, tendencias de b√∫squeda) sin afectar la velocidad de los microservicios transaccionales (GU, CCP). Las consultas de reportes suelen ser largas y pesadas.

**Alternativas:**

* **Consultar Bases de Datos Transaccionales (OLTP) Directamente:** Consultar CCP o GU para los reportes. (Riesgo de bloqueo y ca√≠da del rendimiento del sitio web principal).

* **Usar un Data Warehouse (DW) o Data Lake:** Almac√©n de datos optimizado para consultas complejas, alimentado por eventos as√≠ncronos.

**Criterios de Elecci√≥n:**

* **Rendimiento OLTP:** Garantizar que los reportes no afecten las transacciones de compra/venta.

* **Velocidad de Consulta Anal√≠tica:** Optimizar las consultas complejas y la agregaci√≥n de datos.

**Decisi√≥n:**
  Obtenci√≥n de datos de un Data Warehouse (DW) o Data Lake especializado, alimentado as√≠ncronamente desde los microservicios transaccionales.

**Sustento:**
  Utilizar un DW asegura que las consultas anal√≠ticas no impacten el **Rendimiento** y la **Disponibilidad** de las funcionalidades centrales (compras, cat√°logo), que son cr√≠ticas para el negocio. Los datos se replican v√≠a eventos as√≠ncronos, manteniendo el **Desacoplamiento**.

[üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../4.8.2/4.8.2.md)