> [4. Decisiones Iniciales de Arquitectura](../../4.md) › [4.8. Listado Consolidado](../4.8.md) › [4.8.1. Asignación de Responsabilidades](4.8.1.md)

# 4.8.1. Asignación de Responsabilidades

Este apartado define las fronteras de cada microservicio (módulo) y las responsabilidades únicas que asume dentro del sistema.

## 00: Decisiones Generales
---
### Decisión 1: Elección entre arquitectura monolítica y de microservicios

**Título:**
Elección entre Arquitectura Monolítica y Arquitectura de Microservicios

**Contexto:**
GameVault requiere manejar múltiples dominios (compra/venta, catálogo masivo, logística) con diferentes ritmos de cambio y demandas de escalabilidad. El Catálogo es de solo lectura y el Carrito/Pedidos es transaccional crítico, exigiendo alta disponibilidad.

**Alternativas:**

* **Arquitectura Monolítica:** Todos los módulos integrados. Simplifica el desarrollo inicial, pero un fallo en cualquier componente puede afectar toda la plataforma. Dificulta la escalabilidad modular.

* **Arquitectura de Microservicios:** Cada dominio funciona como servicio independiente. Permite escalabilidad granular, aislamiento de fallos y el uso de tecnologías específicas por módulo.

**Criterios de Elección:**

* **Escalabilidad:** Capacidad de escalar módulos de alta demanda (Catálogo) independientemente de los transaccionales (Pedidos).

* **Disponibilidad y Tolerancia a Fallos:** Garantizar que un fallo en un módulo no detenga las ventas o la búsqueda.

* **Flexibilidad Tecnológica:** Posibilidad de usar diferentes bases de datos o lenguajes según la necesidad del módulo.

**Decisión:**
  Arquitectura de Microservicios.

**Sustento:**
  La diferencia en los requisitos de datos y la carga de trabajo entre los dominios de GameVault (ej. Catálogo masivo vs. Carrito transaccional) justifica la separación. Esta arquitectura garantiza el **Desacoplamiento** y permite la **Escalabilidad Horizontal** granular, lo cual es vital para una plataforma de comercio electrónico que prioriza la **Disponibilidad** de las ventas.

### Decisión 2: Asignación de responsabilidades entre módulos frontend y backend

**Título:**
División de Responsabilidades entre Frontend (UI) y Backend (Lógica de Negocio)

**Contexto:**
GameVault requiere alta interactividad (filtrado instantáneo, experiencia de compra fluida) con máxima seguridad y consistencia en las transacciones (precios, impuestos). Es crucial definir dónde reside la lógica de negocio central.

**Alternativas:**

* **Frontend Grueso:** El Frontend maneja la mayor parte de las validaciones y lógica de estado, usando el Backend solo para persistencia básica.

* **Enfoque Híbrido:** Frontend maneja estado de UI y validaciones de formato. Backend gestiona la lógica de negocio crítica, la seguridad, y la consistencia de los datos.

**Criterios de Elección:**

* **Seguridad:** La lógica de precios y descuentos debe ser inalterable por el usuario.

* **Consistencia:** Asegurar que los datos mostrados reflejen siempre la única fuente de verdad.

* **Experiencia de Usuario (UX):** Permitir interacciones rápidas y fluidas.

**Decisión:**
  Enfoque Híbrido: Backend como Fuente Única de Verdad para el Negocio.

**Sustento:**
  El Backend es el único responsable de la **Seguridad** y la **Consistencia** (aplicación de reglas de precios e impuestos), previniendo fraude. El Frontend (React) optimiza la **UX** gestionando el estado de la UI y las validaciones de formato.

## 01: Módulo: Catálogo de Productos
---
### Decisión 1: Responsabilidad de la Ingesta y Dispersión de Datos para Búsqueda y Filtrado.

**Título:**
Estrategia de Persistencia para Búsqueda y Filtrado de Catálogo

**Contexto:**
El Catálogo (CP) maneja millones de registros y debe permitir búsquedas y filtrados por múltiples criterios (consola, género, condición, rareza) con latencia ultrabaja.

**Alternativas:**

* **Base de Datos Relacional Tradicional:** Usar solo PostgreSQL o MySQL. Fácil de gestionar, pero lento para búsquedas de texto completo y filtrados multidimensionales complejos.

* **Motor de Búsqueda Dedicado:** Utilizar un motor especializado (ej. Elasticsearch, Solr) para indexar los datos relevantes. Ofrece velocidad y funcionalidad avanzada de búsqueda.

**Criterios de Elección:**

* **Velocidad de Respuesta:** Búsquedas y filtros casi instantáneos ($\le 100$ ms).

* **Funcionalidad:** Soporte nativo para *faceted search* y búsqueda de texto.

* **Disponibilidad:** Garantizar que el servicio de búsqueda no falle.

**Decisión:**
  Utilizar un motor de búsqueda/índice dedicado (ej. Elasticsearch) para búsquedas y filtrado de alto rendimiento.

**Sustento:**
  Un motor de búsqueda dedicado garantiza la **Velocidad de Respuesta** y **Disponibilidad** requeridas para el Catálogo. El microservicio CP será responsable de mantener la consistencia entre la base de datos maestra (para la verdad de los datos) y el índice de búsqueda (para la velocidad de consulta).

## 02: Módulo: Gestión de Usuarios
---
### Decisión 1: Responsabilidad de la gestión de la identidad y autenticación de usuarios.

**Título:**
Delegación de la Gestión de Autenticación y Credenciales

**Contexto:**
El Módulo GU debe manejar el registro, inicio de sesión (*passwordless*, redes sociales), perfiles y autorización para los roles Comprador y Vendedor. La seguridad y el cumplimiento de estándares son prioritarios.

**Alternativas:**

* **Integrar Identidad en GU:** GU almacena credenciales, emite *tokens* y valida permisos, asumiendo toda la carga de seguridad.

* **Delegar a un Identity Provider (IdP) Externo:** Usar un servicio especializado (ej. Auth0, Firebase Auth) para manejar credenciales, delegando solo la gestión del perfil de usuario a GU.

**Criterios de Elección:**

* **Seguridad y Cumplimiento:** Protección de credenciales y uso de estándares (OAuth 2.0, MFA).

* **Eficiencia de Desarrollo:** Reducir la complejidad de implementar autenticación y recuperación de contraseñas.

* **Separación de Responsabilidades:** Aislar la lógica de seguridad del perfil.

**Decisión:**
  Delegar la gestión de credenciales y *tokens* a un IdP externo, con GU gestionando el perfil de usuario y los roles.

**Sustento:**
  Delegar la seguridad a un IdP externo maximiza la **Seguridad** y eficiencia, ya que subcontrata una funcionalidad compleja. GU se enfoca en ser el servicio de perfil enriquecido de GameVault (nombre de *gamer*, *avatar*, roles) sin gestionar credenciales sensibles.

## 03: Módulo: Carrito de Compras y Pedidos
---
### Decisión 1: Responsabilidad de la Lógica de Cálculo de Precios y Creación Atómica de Pedidos.

**Título:**
Centralización de la Lógica de *Checkout* y Consistencia Transaccional

**Contexto:**
CCP debe calcular el precio final (precio base + impuestos - descuentos) de manera precisa y crear el objeto "Pedido" de forma atómica (reservando el inventario si aplica) antes de interactuar con el Sistema de Pagos.

**Alternativas:**

* **Lógica Distribuida:** El Módulo GU calcula descuentos, el Módulo CP da el precio base, y CCP solo orquesta. (Riesgo de inconsistencia y latencia).

* **Lógica Centralizada en CCP:** CCP consulta precios (CP) y descuentos (GU) y aplica toda la lógica de cálculo y reserva internamente.

**Criterios de Elección:**

* **Consistencia Transaccional:** El precio pagado debe ser el precio final del pedido.

* **Seguridad:** Prevenir manipulación de cálculos.

* **Trazabilidad:** Facilidad para auditar la lógica de precios.

**Decisión:**
  Centralizar la lógica de cálculo y la creación del objeto "Pedido" en CCP antes de la integración con el Sistema de Pagos.

**Sustento:**
  Centralizar la lógica en CCP permite controlar la **Consistencia Transaccional** y la **Seguridad** de forma atómica. CCP se convierte en la única fuente de verdad del pedido en curso, generando un ID que referenciará el Pago y la Logística, simplificando la **trazabilidad**.

## 04: Módulo: Sistema de Pagos
---
### Decisión 1: Responsabilidad del cumplimiento de seguridad de datos sensibles.

**Título:**
Estrategia para el Manejo y Custodia de Datos Financieros Sensibles

**Contexto:**
SP debe integrarse con múltiples pasarelas (PayPal, Yape, Plin) y gestionar la confirmación de la transacción. Es imperativo cumplir con los estándares de seguridad financiera (PCI DSS) y minimizar la exposición a datos sensibles.

**Alternativas:**

* **SP Almacena Datos:** SP captura y almacena información de tarjetas de crédito/billeteras. (Implica cumplimiento PCI DSS completo y auditorías complejas).

* **Delegación con Tokenización:** SP usa *widgets* o redirecciones de las pasarelas para que el cliente ingrese sus datos en la pasarela, y solo recibe un *token* de vuelta para procesar el pago.

**Criterios de Elección:**

* **Seguridad:** Máxima protección de la información del cliente.

* **Cumplimiento:** Reducir el alcance del cumplimiento PCI DSS en la infraestructura de GameVault.

* **Complejidad Operacional:** Minimizar la gestión de infraestructura de alta seguridad.

**Decisión:**
  Delegar la custodia y manejo de información financiera sensible a las pasarelas de pago externas (Uso de *tokens* o redirecciones).

**Sustento:**
  Delegar esta responsabilidad reduce drásticamente el riesgo de **seguridad** y el alcance del **cumplimiento PCI DSS** en GameVault, ya que el módulo SP solo manejará *tokens* de transacción y confirmaciones de pago, nunca los datos de tarjetas de crédito.

## 05: Módulo: Logística y Envíos
---
### Decisión 1: Responsabilidad del Cálculo de Costos en Tiempo Real y el Seguimiento Asíncrono.

**Título:**
Estrategia de Comunicación para Costos de Envío y Trazabilidad

**Contexto:**
LE debe interactuar con APIs de transportistas para dos tareas diferentes: 1) Calcular el costo de envío (crítico, síncrono, durante el *checkout*) y 2) Actualizar el estado del seguimiento del pedido (no crítico, asíncrono, post-compra).

**Alternativas:**

* **Completamente Síncrono:** Todas las interacciones, incluido el seguimiento, se hacen vía REST/API, bloqueando el proceso principal. (Riesgo de latencia en el seguimiento).

* **Integración Síncrona / Worker Asíncrono:** Cálculo de costos síncrono. Seguimiento de estado delegado a un proceso secundario (*Worker Service*).

**Criterios de Elección:**

* **Velocidad de Checkout:** El cálculo del costo no debe añadir latencia excesiva.

* **Aislamiento de Fallos:** Los fallos en la API de seguimiento de la transportista no deben afectar el *checkout*.

* **Eficiencia:** El seguimiento requiere consultas periódicas a APIs externas.

**Decisión:**
  Integración Síncrona para el Cálculo de Costos y un Worker Service Asíncrono para el Seguimiento del Estado.

**Sustento:**
  El cálculo de costos es un requisito crítico y **síncrono** que debe ser rápido. El seguimiento es ideal para un *Worker Service* **Asíncrono** porque requiere tareas periódicas (consultas a la API del transportista) que podrían ser lentas o fallar, aislando esta complejidad del flujo de venta principal.

## 06: Módulo: Comunidad y Reseñas
---
### Decisión 1: Separación de la Lógica de Moderación de Reseñas de la Persistencia de Datos.

**Título:**
Gestión de Moderación de Contenido Generado por el Usuario

**Contexto:**
CR permite a los usuarios dejar reseñas y valoraciones. El contenido debe pasar por moderación (lenguaje inapropiado, *spam*, etc.) sin generar latencia para la experiencia de envío del usuario.

**Alternativas:**

* **Moderación Síncrona:** El servicio CR aplica los filtros y persiste la reseña en estado final antes de responder al usuario. (Alta latencia, mal UX).

* **Moderación Asíncrona:** El servicio CR persiste la reseña en estado "Pendiente" y un *Worker* (o función *serverless*) aplica la moderación en segundo plano.

**Criterios de Elección:**

* **Rendimiento/UX:** Evitar latencia en la confirmación de envío de la reseña.

* **Robustez:** Aislar la lógica pesada de procesamiento de texto/IA para el filtrado.

**Decisión:**
  Delegación de la Moderación a un Servicio Asíncrono.

**Sustento:**
  Confirmar la reseña al usuario inmediatamente (estado "Pendiente") mejora la **UX** y el **Rendimiento**. Aislar la lógica de moderación en un proceso asíncrono garantiza la **Robustez** del microservicio principal y permite procesar contenido con herramientas especializadas (ej. ML para detección de *spam*) sin bloquear la API web.

## 07: Módulo: Análisis de Datos y Reportes

### Decisión 1: Fuente de Datos para la Generación de Reportes y Métricas.

**Título:**
Estrategia de Persistencia para Consultas Analíticas

**Contexto:**
ADR debe generar métricas complejas (*ranking* de ventas, tendencias de búsqueda) sin afectar la velocidad de los microservicios transaccionales (GU, CCP). Las consultas de reportes suelen ser largas y pesadas.

**Alternativas:**

* **Consultar Bases de Datos Transaccionales (OLTP) Directamente:** Consultar CCP o GU para los reportes. (Riesgo de bloqueo y caída del rendimiento del sitio web principal).

* **Usar un Data Warehouse (DW) o Data Lake:** Almacén de datos optimizado para consultas complejas, alimentado por eventos asíncronos.

**Criterios de Elección:**

* **Rendimiento OLTP:** Garantizar que los reportes no afecten las transacciones de compra/venta.

* **Velocidad de Consulta Analítica:** Optimizar las consultas complejas y la agregación de datos.

**Decisión:**
  Obtención de datos de un Data Warehouse (DW) o Data Lake especializado, alimentado asíncronamente desde los microservicios transaccionales.

**Sustento:**
  Utilizar un DW asegura que las consultas analíticas no impacten el **Rendimiento** y la **Disponibilidad** de las funcionalidades centrales (compras, catálogo), que son críticas para el negocio. Los datos se replican vía eventos asíncronos, manteniendo el **Desacoplamiento**.

[🏠 Home](../../../README.md) | [Siguiente ➡️](../4.8.2/4.8.2.md)