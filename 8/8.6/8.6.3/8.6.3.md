> [8. Aplicaci√≥n de Patrones Arquitecturales](../../8.md) ‚Ä∫ [8.6. Listado Consolidado](../8.6.md) ‚Ä∫ [8.6.3. Patrones de Asignaci√≥n](8.6.3.md)

# 8.6.3. Patrones de Asignaci√≥n


## **03: M√≥dulo: Carrito de Compras y Pedidos**

---

**T√≠tulo:**
Asignaci√≥n de componentes del `Servicio de Carrito y Pedidos (CCP)` en un Patr√≥n Multi-Tier

**Contexto:**
El `Servicio de Carrito y Pedidos` (M√≥dulo 3) es un componente transaccional que maneja datos sensibles (pedidos de clientes) y datos de alta volatilidad (carritos). Debemos decidir c√≥mo se asignar√° este contenedor de software a la infraestructura de red en producci√≥n para garantizar la seguridad de los datos del pedido y el rendimiento del carrito.

**Alternativas:**

* **Patr√≥n Multi-Tier (N-Capas):**
    * El `Servicio CCP` se asigna a un "Tier" de aplicaci√≥n en una **red privada**.
    * Sus bases de datos (`PostgreSQL` para pedidos, `Redis` para carritos) se asignan a un "Tier" de datos en una **red aislada**.
    * Ventaja: M√°xima seguridad. El acceso directo a la BD de pedidos desde Internet es imposible.
    * Ventaja: Permite escalar el servicio de CCP independientemente de sus bases de datos.

* **Despliegue en un Solo Tier (Flat Deployment):**
    * Asignar el `Servicio CCP` y sus bases de datos (`PostgreSQL`, `Redis`) a la misma red donde reside el `API Gateway` (expuesto a Internet).
    * Ventaja: Configuraci√≥n de red m√°s simple.
    * Desventaja: Brecha de seguridad grave. Una vulnerabilidad en el Gateway podr√≠a exponer directamente la BD de pedidos y la cach√© de carritos.

**Criterios de elecci√≥n:**

* **Seguridad:** Aislamiento de la base de datos de pedidos (datos sensibles) del acceso p√∫blico.
* **Rendimiento:** Asegurar la conectividad de baja latencia entre el `CCP` y su cach√© `Redis`.
* **Cumplimiento de Restricciones:** Alineaci√≥n con la restricci√≥n de usar `Kubernetes`, que facilita la segmentaci√≥n de red.

**Decisi√≥n:**
Se adopta el patr√≥n **Multi-Tier** para el despliegue del `Servicio de Carrito y Pedidos (CCP)` y sus bases de datos.

**Sustento:**
Este patr√≥n es la √∫nica alternativa que cumple con los requisitos de seguridad para los datos de pedidos. Al asignar el `Servicio CCP` al **Tier de Aplicaci√≥n (Red Privada)** y sus bases de datos (`PostgreSQL` y `Redis`) al **Tier de Datos (Red Aislada)**, garantizamos que un atacante no pueda acceder directamente a la informaci√≥n. El `API Gateway` (Tier 2) filtra el tr√°fico antes de que llegue al `CCP` (Tier 3).

## **04: M√≥dulo: Sistema de Pagos**

---

**T√≠tulo:**
Asignaci√≥n de componentes del Servicio de Pagos (SP) en un Patr√≥n Multi-Tier

**Contexto:**
El Servicio de Pagos (M√≥dulo 4) es un componente cr√≠tico que maneja informaci√≥n financiera y se comunica con un socio externo (Culqi). Debemos decidir c√≥mo se asignar√° este contenedor de software a la infraestructura de red en producci√≥n para garantizar la m√°xima seguridad y cumplir con los est√°ndares de pago (PCI-DSS).

**Alternativas:**

* **Patr√≥n Multi-Tier (N-Capas):**
    * El Servicio de Pagos (SP) se asigna a un "Tier" de aplicaci√≥n en una red privada, aislado de Internet.
    * La Base de Datos de Pagos (PostgreSQL) se asigna a un "Tier" de datos en una red aislada, inaccesible excepto desde el Tier de aplicaci√≥n.
    * Ventaja: M√°xima seguridad. El acceso directo a la BD de pagos desde Internet es imposible.

* **Despliegue en un Solo Tier (Flat Deployment):**
    * Asignar el Servicio de Pagos (SP) y su Base de Datos (PostgreSQL) a la misma red donde reside el API Gateway (expuesto a Internet).
    * Ventaja: Configuraci√≥n de red m√°s simple.
    * Desventaja: Brecha de seguridad grave. Una vulnerabilidad en el Gateway podr√≠a exponer directamente la BD de transacciones.

**Criterios de elecci√≥n:**

* **Seguridad (PCI-DSS):** Cumplir con la restricci√≥n de que los datos financieros sensibles deben estar protegidos y aislados.
* **Aislamiento:** Asegurar que el Servicio de Pagos solo reciba tr√°fico leg√≠timo desde el API Gateway y el Servicio de Pedidos.
* **Cumplimiento de Restricciones:** Alineaci√≥n con la restricci√≥n de usar Kubernetes, que facilita este tipo de segmentaci√≥n de red.

**Decisi√≥n:**
Se adopta el patr√≥n Multi-Tier para el despliegue del Servicio de Pagos (SP) y su base de datos.

**Sustento:**
Este patr√≥n es la √∫nica alternativa que cumple con los requisitos de seguridad para el M√≥dulo 4. Al asignar el Servicio de Pagos (SP) al Tier de Aplicaci√≥n (Red Privada) y su base de datos PostgreSQL al Tier de Datos (Red Aislada), garantizamos que un atacante no pueda acceder directamente a la informaci√≥n de transacciones. El API Gateway (Tier 2) act√∫a como un "guardia de seguridad" que filtra el tr√°fico antes de que llegue al SP (Tier 3).    

---
## **05: M√≥dulo: Comunidad y Rese√±as**

---

**T√≠tulo:**
Patr√≥n de Microservicio (Asignaci√≥n en Contenedor Independiente)

**Contexto:**
El `Servicio de Comunidad y Rese√±as (SCR)` (M√≥dulo 05) debe ser asignado a la infraestructura de ejecuci√≥n. Este m√≥dulo tiene un perfil de carga muy diferente al resto (alta lectura, baja escritura). Se debe decidir si desplegar este componente de forma aislada o como parte de un despliegue m√°s grande.

**Alternativas:**

* **Patr√≥n de Microservicio (Asignaci√≥n Independiente en Contenedor):**
    * El `SCR` se empaqueta y despliega como un servicio separado (ej. Docker/Kubernetes).
    * Ventaja: **Escalabilidad Granular** (escalar solo Rese√±as) y **Aislamiento de Fallos** (un bug en `SCR` no afecta los Pagos).
    * Desventaja: Mayor complejidad de red y gesti√≥n de servicios.

* **Patr√≥n Monol√≠tico (Asignaci√≥n Multi-Tier Cl√°sica):**
    * Se despliega *toda* la aplicaci√≥n (Rese√±as + Pagos + Carrito) como un solo bloque l√≥gico (el "Monolito") en un **Nivel de Aplicaci√≥n** (Tier 2).
    * Este nivel se comunica con un **Nivel de Base de Datos** (Tier 3) separado.
    * Ventaja: M√°s estructurado y seguro que un monolito unificado simple (separaci√≥n de BD y App).
    * Desventaja: Sigue teniendo escalabilidad "todo o nada" y cero aislamiento de fallos *dentro* del Nivel de Aplicaci√≥n.

* **Patr√≥n Monol√≠tico (Asignaci√≥n Unificada Simple):**
    * Desplegar *toda* la aplicaci√≥n (el c√≥digo) y la base de datos en el *mismo servidor* o m√°quina virtual (Tier 1).
    * Ventaja: M√°xima simplicidad para prototipos o desarrollo.
    * Desventaja: Cero escalabilidad, cero resiliencia, alto riesgo de seguridad.

**Criterios de elecci√≥n:**

* **Resiliencia (Aislamiento de Fallos):** La falla de un m√≥dulo no cr√≠tico (Rese√±as) no debe afectar a m√≥dulos cr√≠ticos (Pagos, Carrito).
* **Escalabilidad Granular:** Capacidad de escalar servicios individualmente.
* **Mantenibilidad:** Poder actualizar el SCR sin redesplegar toda la plataforma.

**Decisi√≥n:**
Se adopta el **Patr√≥n de Microservicio (Asignaci√≥n Independiente en Contenedor)**.

**Sustento:**
Se descartan las dos alternativas monol√≠ticas. La **Asignaci√≥n Unificada Simple** no es viable para producci√≥n. La **Asignaci√≥n Multi-Tier** es mejor, pero a√∫n viola el criterio de Resiliencia: un bug en el c√≥digo de Rese√±as colapsar√≠a todo el Nivel de Aplicaci√≥n, deteniendo las ventas. El **Patr√≥n de Microservicio** es el √∫nico que garantiza el aislamiento de fallos y la escalabilidad granular que este m√≥dulo (con su perfil de carga √∫nico) requiere.

[‚¨ÖÔ∏è Anterior](../8.6.2/8.6.2.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../8.6.4/8.6.4.md)
