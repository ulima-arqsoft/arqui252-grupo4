> [8. Aplicaci√≥n de Patrones Arquitecturales](../../8.md) ‚Ä∫ [8.6. Listado Consolidado](../8.6.md) ‚Ä∫ [8.6.1. Patrones de M√≥dulo](8.6.1.md)

# 8.6.1. Patrones de M√≥dulo

## **03: M√≥dulo: Carrito de Compras y Pedidos**

---

**T√≠tulo:**
Organizaci√≥n modular interna del `Servicio de Carrito y Pedidos (CCP)` (Patr√≥n en Capas)

**Contexto:**
El `Servicio de Carrito y Pedidos` (M√≥dulo 3) es un microservicio que debe manejar la l√≥gica de negocio (calcular totales, validar stock), la l√≥gica de API (recibir peticiones HTTP) y la l√≥gica de persistencia (escribir en Redis y PostgreSQL). Se requiere una estructura de c√≥digo interna que separe estas responsabilidades para que el servicio sea mantenible y testeable.

**Alternativas:**

* **Patr√≥n de Arquitectura en Capas (Layered Architecture):**
    * Organizaci√≥n horizontal por capas t√©cnicas: `Controllers`, `Services`, `Repositories`.
    * Facilita la separaci√≥n de responsabilidades: la l√≥gica de HTTP (Controller) est√° separada de la l√≥gica de negocio (Service) y de la l√≥gica de BD (Repository).
    * Permite la abstracci√≥n de dependencias y facilita las pruebas.

* **Estructura Ad-hoc (Sin Patr√≥n):**
    * Implementar toda la l√≥gica (API, negocio, BD) del carrito y los pedidos en un solo archivo `index.ts`.
    * Dificulta la evoluci√≥n (ej. cambiar de Redis a otra BD).
    * Genera alto acoplamiento y baja cohesi√≥n.

**Criterios de elecci√≥n:**

* **Mantenibilidad:** Facilidad para modificar la l√≥gica de c√°lculo de totales sin afectar el endpoint de la API.
* **Testabilidad:** Capacidad de probar la l√≥gica de `OrderService` (M√≥dulo 3) "mockeando" (simulando) el `PaymentAdapter` y el `OrderRepository`.
* **Cohesi√≥n:** Agrupar l√≥gicamente las responsabilidades (`RF-01` a `RF-06` del M√≥dulo 3).

**Decisi√≥n:**
Se adopta el **Patr√≥n de Arquitectura en Capas** para la estructura interna del `Servicio de Carrito y Pedidos (CCP)`.

**Sustento:**
La arquitectura en capas es la implementaci√≥n directa de nuestro **Diagrama de Componentes (C4 Nivel 3)**. Permite que el `CCP` tenga una estructura limpia que separa `CartController`/`OrderController` (la API), `CartService`/`OrderService` (el negocio) y `CartRepository`/`OrderRepository` (los datos). Esto es crucial para manejar la complejidad de este m√≥dulo, que escribe en dos BD distintas (`Redis` y `PostgreSQL`) y orquesta una llamada a otro servicio (`SP`).

## **04: M√≥dulo: Sistema de Pagos**

---

**T√≠tulo:**
Organizaci√≥n modular interna del Servicio de Pagos (SP) (Patr√≥n en Capas)

**Contexto:**
El Servicio de Pagos (M√≥dulo 4) es un microservicio de alta criticidad. Debe manejar la l√≥gica para conectarse a Culqi, la l√≥gica de negocio para validar pagos, la l√≥gica de API para recibir llamadas del CCP y los webhooks de Culqi, y la l√≥gica de persistencia para guardar transacciones en PostgreSQL. Se necesita una estructura de c√≥digo interna que separe estas responsabilidades.

**Alternativas:**

* **Patr√≥n de Arquitectura en Capas (Layered Architecture):**
    * Organizaci√≥n horizontal por capas t√©cnicas: Controllers, Services, Repositories.
    * Facilita la separaci√≥n de responsabilidades: la l√≥gica de Webhook (Controller) est√° separada de la l√≥gica de negocio (Service) y de la l√≥gica de BD (Repository).
    * Permite la encapsulaci√≥n de la API de Culqi en un Adapter.

* **Estructura Ad-hoc (Sin Patr√≥n):**
    * Mezclar la l√≥gica del webhook de Culqi directamente con la escritura en la base de datos en un solo archivo.
    * Dificulta la evoluci√≥n (ej. a√±adir otro proveedor de pago como Stripe).
    * Dificulta las pruebas y la mantenibilidad.

**Criterios de elecci√≥n:**

* **Mantenibilidad:** Facilidad para modificar la l√≥gica de conexi√≥n a Culqi sin afectar el resto del servicio (T√°ctica ESC-SP-03: Encapsulamiento).
* **Testabilidad:** Capacidad de probar la l√≥gica de PaymentService "mockeando" (simulando) el CulqiAdapter.
* **Cohesi√≥n:** Agrupar l√≥gicamente las responsabilidades (RF-01 a RF-06 del M√≥dulo 4).

**Decisi√≥n:**
Se adopta el Patr√≥n de Arquitectura en Capas para la estructura interna del Servicio de Pagos (SP).

**Sustento:**
La arquitectura en capas es la implementaci√≥n directa de nuestro Diagrama de Componentes (C4 Nivel 3). Permite que el SP implemente la t√°ctica ESC-SP-03 (Encapsulamiento) al aislar la l√≥gica de Culqi en un CulqiAdapter. El PaymentService contiene la l√≥gica de negocio, y el TransactionRepository maneja la persistencia en PostgreSQL. Esta separaci√≥n es crucial para un m√≥dulo de alta seguridad.

---

[üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../8.6.2/8.6.2.md)