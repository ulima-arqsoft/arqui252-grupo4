# 2.2.4. Módulo 4
- [Volver al índice](/2/2.md)

## Módulo de Sistema de Pagos

| ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta Esperada | Métrica (Respuesta) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
**ESC-05** | Actor malicioso (externo) | Intento de pago con una tarjeta de crédito previamente reportada como fraudulenta. | Microservicio de Pagos / Sistema Antifraude | Producción | La transacción es rechazada automáticamente y se genera una alerta de seguridad interna. | El **100% de los intentos** con tarjetas en la lista negra son bloqueados. |
| **ESC-09** | API externa (Proveedor de pago) | Falla de red intermitente al procesar una transacción. | Sistema de colas de mensajes (asíncrono) | Producción | El sistema reintenta procesar el pago automáticamente hasta 3 veces en un lapso de 5 minutos. | **99% de las transacciones** con fallos intermitentes se completan exitosamente. |
| **ESC-11** | Desarrollador | Se solicita añadir un nuevo campo (`payment_method_id`) a la tabla de transacciones de pago. | ORM / Esquema de la BD de Pagos | Desarrollo | La migración de la base de datos se aplica y las pruebas de integración específicas de pago se ejecutan sin fallos. | El cambio se completa en **menos de 2 horas-hombre** y el **100% de las pruebas pasan**. |
| **ESC-25** | Scripts de QA (Pruebas de Carga) | Se envían 10 solicitudes por minuto al endpoint `/payment`. | Rate Limiter del API Gateway | Producción | Las primeras 3 solicitudes son exitosas (código 200), las siguientes reciben un error `429 Too Many Requests`. | El **100% de las solicitudes** que exceden el límite son bloqueadas con el código 429. |
| **ESC-26** |Usuario | El usuario introduce un número de tarjeta de crédito inválido y presiona "Pagar". | Formulario de Pago (Frontend) | Producción | El sistema muestra un mensaje de error claro ("Número de tarjeta inválido") en **menos de 500ms** y no intenta procesar el pago. | El **100% de los formatos de tarjeta inválidos** son detectados en el cliente sin enviar la solicitud. |
| **ESC-28** | Usuario | El usuario solicita exportar su historial de pagos de los últimos 6 meses. | Microservicio de Reportes de Pagos | Producción | Se genera un archivo en formato **PDF/A-1b** que contiene la fecha, monto y estado de cada transacción. | El **100% de los reportes generados son válidos** y contienen los datos correctos del período solicitado. |
| **ESC-10** | Usuario | Un usuario, debido a una red lenta, hace doble clic en el botón "Confirmar Pago". | Microservicio de Pagos (Lógica de Idempotencia) | Producción | El sistema procesa la primera solicitud, pero identifica y rechaza la segunda como un duplicado, garantizando un único cobro. | El **100% de las solicitudes duplicadas** para la misma orden son rechazadas. |